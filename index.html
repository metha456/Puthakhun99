<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>พุทธคุณ 99 - วัตถุมงคลแท้เศรษฐี</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --gold-primary: #D4AF37;
            --gold-light: #F4D03F;
            --gold-dark: #B8860B;
            --thai-black: #0F0F0F;
            --thai-red: #8B0000;
        }

        * {
            font-family: 'Noto Sans Thai', sans-serif;
        }

        body {
            background-color: var(--thai-black);
            color: #E8E8E8;
            overflow-x: hidden;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
        }

        .gold-gradient {
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-light) 50%, var(--gold-primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .gold-bg {
            background: linear-gradient(135deg, var(--gold-primary), var(--gold-light), var(--gold-primary));
            background-size: 200% 200%;
        }

        .glass {
            background: rgba(26, 26, 26, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(212, 175, 55, 0.15);
            border-radius: 12px;
        }

        .glass-header {
            background: rgba(10, 10, 10, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(212, 175, 55, 0.1);
        }

        .thai-pattern {
            background-image: repeating-linear-gradient(45deg, transparent, transparent 2px, rgba(212, 175, 55, 0.03) 2px, rgba(212, 175, 55, 0.03) 4px);
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes glow-pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(212, 175, 55, 0.3); }
            50% { box-shadow: 0 0 40px rgba(212, 175, 55, 0.6); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .animate-fade-in-up { animation: fadeInUp 0.6s ease-out; }
        .animate-slide-in-right { animation: slideInRight 0.6s ease-out; }
        .animate-glow { animation: glow-pulse 2s ease-in-out infinite; }
        .animate-spin { animation: spin 1s linear infinite; }

        .product-card {
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-12px) scale(1.02);
        }

        .product-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.4s;
            border-radius: 12px;
            pointer-events: none;
        }

        .product-card:hover::before {
            opacity: 1;
        }

        .btn-gold {
            background: linear-gradient(135deg, var(--gold-primary), var(--gold-light));
            color: var(--thai-black);
            font-weight: 700;
            border: none;
            padding: 12px 28px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .btn-gold::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transition: left 0.3s;
        }

        .btn-gold:hover {
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.4);
            transform: translateY(-2px);
        }

        .btn-gold:hover::before {
            left: 100%;
        }

        .btn-outline-gold {
            border: 2px solid var(--gold-primary);
            color: var(--gold-primary);
            background: transparent;
            font-weight: 600;
            padding: 10px 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-outline-gold:hover {
            background: var(--gold-primary);
            color: var(--thai-black);
        }

        .loading-spinner {
            border: 3px solid rgba(212, 175, 55, 0.2);
            border-top-color: var(--gold-primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(212, 175, 55, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gold-primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gold-light);
        }
    </style>
</head>
<body class="bg-black">

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-6"></div>
            <p class="text-amber-500 text-lg">กำลังโหลด...</p>
        </div>
    </div>

    <!-- Navigation -->
    <nav id="navbar" class="glass-header fixed w-full z-40 top-0 transition-all duration-300">
        <div class="container mx-auto px-4 lg:px-8 py-4">
            <div class="flex justify-between items-center">
                <a href="#" onclick="showPage('home'); return false;" class="flex items-center space-x-3 hover:opacity-80 transition-opacity">
                    <div class="gold-bg w-12 h-12 rounded-full flex items-center justify-center shadow-lg">
                        <i class="fas fa-om text-black text-xl font-bold"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold gold-gradient">พุทธคุณ</h1>
                        <p class="text-xs text-amber-500 tracking-widest">PUTHAKHUN99</p>
                    </div>
                </a>

                <div class="hidden lg:flex items-center space-x-8">
                    <a href="#" onclick="showPage('home'); return false;" class="text-white hover:text-amber-400 transition-colors font-medium">หน้าแรก</a>
                    <a href="#" onclick="showPage('products'); return false;" class="text-white hover:text-amber-400 transition-colors font-medium">วัตถุมงคล</a>
                    <a href="#" onclick="showPage('bookings'); return false;" class="text-white hover:text-amber-400 transition-colors font-medium">จองออนไลน์</a>
                    <a href="#" onclick="showPage('wallet'); return false;" class="text-white hover:text-amber-400 transition-colors font-medium">กระเป๋าเงิน</a>
                </div>

                <div class="flex items-center space-x-4">
                    <button onclick="toggleCart()" class="relative p-2 hover:text-amber-400 transition-colors">
                        <i class="fas fa-shopping-cart text-2xl"></i>
                        <span id="cart-count" class="absolute -top-1 -right-1 w-6 h-6 bg-red-600 text-white text-xs rounded-full flex items-center justify-center font-bold hidden">0</span>
                    </button>
                    <div id="auth-buttons" class="flex items-center space-x-2">
                        <button id="login-btn" onclick="showAuthModal('login')" class="btn-outline-gold">
                            <i class="fas fa-sign-in-alt mr-2"></i>เข้าสู่ระบบ
                        </button>
                    </div>
                    <div id="user-menu" class="hidden flex items-center space-x-4">
                        <span id="user-display" class="text-amber-400 font-semibold"></span>
                        <button onclick="logout()" class="text-gray-400 hover:text-red-500 transition-colors">
                            <i class="fas fa-sign-out-alt text-lg"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main-content" class="pt-20">
        <!-- Content -->
    </main>

    <!-- Cart Sidebar -->
    <div id="cart-sidebar" class="fixed right-0 top-0 h-screen w-full md:w-96 glass z-50 transform translate-x-full transition-transform duration-300">
        <div class="h-full flex flex-col p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold gold-gradient">ตะกร้าสินค้า</h2>
                <button onclick="toggleCart()" class="text-gray-400 hover:text-white text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div id="cart-items" class="flex-1 overflow-y-auto space-y-4 mb-6">
                <p class="text-gray-400 text-center py-8">ตะกร้าว่างเปล่า</p>
            </div>

            <div class="border-t border-amber-600/20 pt-4">
                <div class="flex justify-between items-center mb-6">
                    <span class="text-gray-300">ยอดรวม</span>
                    <span id="cart-total" class="text-3xl font-bold gold-gradient">฿0</span>
                </div>
                <button onclick="checkout()" class="w-full btn-gold font-bold py-3 rounded-lg">
                    <i class="fas fa-credit-card mr-2"></i>ชำระเงิน
                </button>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="fixed inset-0 modal-overlay z-50 hidden flex items-center justify-center p-4">
        <div class="glass w-full max-w-md p-8 relative animate-fade-in-up">
            <button onclick="closeModal('auth-modal')" class="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl">
                <i class="fas fa-times"></i>
            </button>

            <div id="login-form" class="text-center">
                <div class="gold-bg w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
                    <i class="fas fa-user text-black text-2xl"></i>
                </div>
                <h2 class="text-3xl font-bold gold-gradient mb-6">เข้าสู่ระบบ</h2>
                <form onsubmit="handleLogin(event)" class="space-y-4">
                    <input type="email" id="login-email" placeholder="อีเมล" required
                           class="w-full glass px-4 py-3 text-white placeholder-gray-500 focus:border-amber-500 focus:outline-none">
                    <input type="password" id="login-password" placeholder="รหัสผ่าน" required
                           class="w-full glass px-4 py-3 text-white placeholder-gray-500 focus:border-amber-500 focus:outline-none">
                    <button type="submit" class="w-full btn-gold font-bold py-3 rounded-lg mt-6">
                        <span id="login-btn-text">เข้าสู่ระบบ</span>
                    </button>
                </form>
                <p class="text-gray-400 mt-4 text-sm">
                    ยังไม่มีบัญชี? 
                    <button onclick="switchAuthForm('register')" class="text-amber-400 hover:text-amber-300 transition-colors font-semibold">สมัครสมาชิก</button>
                </p>
            </div>

            <div id="register-form" class="hidden text-center">
                <h2 class="text-3xl font-bold gold-gradient mb-6">สมัครสมาชิก</h2>
                <form onsubmit="handleRegister(event)" class="space-y-4">
                    <input type="text" id="reg-name" placeholder="ชื่อ-นามสกุล" required
                           class="w-full glass px-4 py-3 text-white placeholder-gray-500 focus:border-amber-500 focus:outline-none">
                    <input type="email" id="reg-email" placeholder="อีเมล" required
                           class="w-full glass px-4 py-3 text-white placeholder-gray-500 focus:border-amber-500 focus:outline-none">
                    <input type="tel" id="reg-phone" placeholder="เบอร์โทรศัพท์"
                           class="w-full glass px-4 py-3 text-white placeholder-gray-500 focus:border-amber-500 focus:outline-none">
                    <input type="password" id="reg-password" placeholder="รหัสผ่าน (อย่างน้อย 6 ตัว)" minlength="6" required
                           class="w-full glass px-4 py-3 text-white placeholder-gray-500 focus:border-amber-500 focus:outline-none">
                    <button type="submit" class="w-full btn-gold font-bold py-3 rounded-lg mt-6">
                        <span id="register-btn-text">สมัครสมาชิก</span>
                    </button>
                </form>
                <p class="text-gray-400 mt-4 text-sm">
                    มีบัญชีแล้ว? 
                    <button onclick="switchAuthForm('login')" class="text-amber-400 hover:text-amber-300 transition-colors font-semibold">เข้าสู่ระบบ</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-8 right-8 z-40 glass px-6 py-4 rounded-lg flex items-center space-x-3 transform translate-y-20 opacity-0 transition-all duration-300 pointer-events-none">
        <i id="toast-icon" class="fas fa-check-circle text-green-400 text-xl"></i>
        <span id="toast-text" class="text-white"></span>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged,
            updateProfile 
        } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';
        import { 
            getFirestore, 
            collection, 
            doc, 
            getDoc, 
            getDocs, 
            setDoc, 
            updateDoc, 
            addDoc,
            query, 
            orderBy,
            serverTimestamp,
            increment
        } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAX1CLMo9DtNEcVfSYnNWJltOr9-7o9Jmw",
            authDomain: "puthakhun99.firebaseapp.com",
            projectId: "puthakhun99",
            storageBucket: "puthakhun99.firebasestorage.app",
            messagingSenderId: "255093387312",
            appId: "1:255093387312:web:8430bf772a9518ad17bdf5",
            measurementId: "G-TB7TH5YL2D"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.appState = {
            currentUser: null,
            cart: JSON.parse(localStorage.getItem('cart') || '[]'),
            products: [],
            bookings: []
        };

        // Auth Functions
        window.handleLogin = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('login-btn-text');
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            btn.textContent = 'กำลังเข้าสู่ระบบ...';
            try {
                const result = await signInWithEmailAndPassword(auth, email, password);
                const userDoc = await getDoc(doc(db, 'users', result.user.uid));
                
                window.appState.currentUser = {
                    uid: result.user.uid,
                    email: result.user.email,
                    ...userDoc.data()
                };

                closeModal('auth-modal');
                updateUI();
                showToast('เข้าสู่ระบบสำเร็จ!');
            } catch (error) {
                showToast('อีเมลหรือรหัสผ่านไม่ถูกต้อง', 'error');
            } finally {
                btn.textContent = 'เข้าสู่ระบบ';
            }
        };

        window.handleRegister = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('register-btn-text');
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const phone = document.getElementById('reg-phone').value;
            const password = document.getElementById('reg-password').value;

            btn.textContent = 'กำลังสมัคร...';
            try {
                const result = await createUserWithEmailAndPassword(auth, email, password);
                await updateProfile(result.user, { displayName: name });
                
                await setDoc(doc(db, 'users', result.user.uid), {
                    uid: result.user.uid,
                    name,
                    email,
                    phone,
                    role: 'customer',
                    wallet: 0,
                    createdAt: serverTimestamp()
                });

                window.appState.currentUser = {
                    uid: result.user.uid,
                    email,
                    name,
                    phone,
                    role: 'customer',
                    wallet: 0
                };

                closeModal('auth-modal');
                updateUI();
                showToast('สมัครสมาชิกสำเร็จ!');
            } catch (error) {
                showToast('อีเมลนี้มีผู้ใช้งานแล้ว', 'error');
            } finally {
                btn.textContent = 'สมัครสมาชิก';
            }
        };

        window.logout = async () => {
            await signOut(auth);
            window.appState.currentUser = null;
            window.appState.cart = [];
            localStorage.removeItem('cart');
            updateUI();
            renderCart();
            showToast('ออกจากระบบสำเร็จ');
        };

        // Data Loading
        async function loadProducts() {
            try {
                const q = query(collection(db, 'products'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                window.appState.products = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
            } catch (error) {
                console.error('Load products error:', error);
            }
        }

        async function loadBookings() {
            try {
                const q = query(collection(db, 'bookings'), orderBy('date', 'asc'));
                const snapshot = await getDocs(q);
                window.appState.bookings = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
            } catch (error) {
                console.error('Load bookings error:', error);
            }
        }

        // Page Rendering
        window.showPage = async (page) => {
            const main = document.getElementById('main-content');
            
            switch(page) {
                case 'home':
                    main.innerHTML = renderHomePage();
                    break;
                case 'products':
                    main.innerHTML = '<div class="flex justify-center py-20"><div class="loading-spinner"></div></div>';
                    await loadProducts();
                    main.innerHTML = renderProductsPage();
                    break;
                case 'bookings':
                    main.innerHTML = '<div class="flex justify-center py-20"><div class="loading-spinner"></div></div>';
                    await loadBookings();
                    main.innerHTML = renderBookingsPage();
                    break;
                case 'wallet':
                    if (!window.appState.currentUser) {
                        showAuthModal('login');
                        return;
                    }
                    main.innerHTML = '<div class="flex justify-center py-20"><div class="loading-spinner"></div></div>';
                    await loadWalletData();
                    break;
            }
            
            window.scrollTo(0, 0);
        };

        function renderHomePage() {
            return `
                <section class="relative min-h-screen bg-gradient-to-b from-black via-gray-900 to-black overflow-hidden">
                    <div class="thai-pattern absolute inset-0 opacity-20"></div>
                    
                    <div class="container mx-auto px-4 lg:px-8 py-20 relative z-10">
                        <div class="grid lg:grid-cols-2 gap-12 items-center">
                            <div class="space-y-8 animate-fade-in-up">
                                <div class="inline-block px-4 py-2 border border-amber-600/50 rounded-full text-amber-400 text-sm font-semibold">
                                    ✦ วัตถุมงคลแท้จากวัดศักดิ์สิทธิ์
                                </div>
                                
                                <h1 class="text-5xl lg:text-6xl font-bold leading-tight">
                                    เสริมสิริมงคล<br>
                                    <span class="gold-gradient">บารมีลึก</span><br>
                                    ด้วยพระเครื่องศักดิ์สิทธิ์
                                </h1>
                                
                                <p class="text-gray-300 text-lg max-w-lg leading-relaxed">
                                    พุทธคุณ 99 นำเสนอวัตถุมงคลคุณภาพสูง พระเครื่องยอดนิยม ที่ผ่านพิธีปลุกเสกอย่างเป็นทางการ
                                </p>
                                
                                <div class="flex flex-wrap gap-4 pt-4">
                                    <button onclick="showPage('products')" class="btn-gold px-8 py-4 rounded-lg font-bold inline-flex items-center">
                                        <i class="fas fa-search mr-3"></i>ดูวัตถุมงคล
                                    </button>
                                    <button onclick="showPage('bookings')" class="btn-outline-gold px-8 py-4 rounded-lg font-bold inline-flex items-center">
                                        <i class="fas fa-calendar mr-3"></i>จองพระใหม่
                                    </button>
                                </div>
                            </div>

                            <div class="relative animate-slide-in-right hidden lg:block">
                                <div class="gold-bg rounded-3xl shadow-2xl opacity-20 absolute inset-0 animate-glow"></div>
                                <div class="relative z-10 aspect-square rounded-3xl overflow-hidden border border-amber-600/30">
                                    <img src="https://images.unsplash.com/photo-1599499810694-b5ac4dd92837?w=600&h=600&fit=crop" 
                                         alt="วัตถุมงคล" class="w-full h-full object-cover">
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="py-20 bg-gradient-to-b from-gray-900 to-black thai-pattern">
                    <div class="container mx-auto px-4 lg:px-8">
                        <div class="text-center mb-16">
                            <h2 class="text-4xl font-bold mb-4">วัตถุมงคลยอดนิยม</h2>
                            <div class="w-20 h-1 gold-bg mx-auto rounded-full"></div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                            ${window.appState.products.slice(0, 4).map((p, i) => `
                                <div class="product-card glass rounded-lg overflow-hidden animate-fade-in-up" style="animation-delay: ${i * 0.1}s">
                                    <div class="relative h-64 overflow-hidden">
                                        <img src="${p.image || 'https://via.placeholder.com/300x300'}" alt="${p.name}" class="w-full h-full object-cover">
                                    </div>
                                    <div class="p-5">
                                        <p class="text-amber-400 text-xs font-semibold mb-1">${p.temple || 'วัดศักดิ์สิทธิ์'}</p>
                                        <h3 class="font-bold text-white mb-2 line-clamp-2">${p.name}</h3>
                                        <div class="flex justify-between items-center">
                                            <span class="text-xl font-bold gold-gradient">฿${(p.price || 0).toLocaleString()}</span>
                                        </div>
                                        <button onclick="addToCart('${p.id}')" class="w-full mt-4 btn-gold py-2 rounded-lg text-sm font-bold">
                                            <i class="fas fa-cart-plus mr-2"></i>เพิ่มตะกร้า
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </section>
            `;
        }

        function renderProductsPage() {
            return `
                <section class="py-20 thai-pattern min-h-screen">
                    <div class="container mx-auto px-4 lg:px-8">
                        <h2 class="text-4xl font-bold mb-2">วัตถุมงคลทั้งหมด</h2>
                        <p class="text-gray-400 mb-8">รวม ${window.appState.products.length} รายการ</p>
                        
                        <div class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                            ${window.appState.products.map((p, i) => `
                                <div class="product-card glass rounded-lg overflow-hidden animate-fade-in-up" style="animation-delay: ${(i % 8) * 0.05}s">
                                    <div class="relative h-64 overflow-hidden">
                                        <img src="${p.image || 'https://via.placeholder.com/300x300'}" alt="${p.name}" class="w-full h-full object-cover">
                                    </div>
                                    <div class="p-5">
                                        <h3 class="font-bold text-white mb-2 line-clamp-2">${p.name}</h3>
                                        <p class="text-gray-400 text-sm mb-3">${p.category || 'วัตถุมงคล'}</p>
                                        <div class="flex justify-between items-center">
                                            <span class="text-xl font-bold gold-gradient">฿${(p.price || 0).toLocaleString()}</span>
                                        </div>
                                        <button onclick="addToCart('${p.id}')" class="w-full mt-4 btn-gold py-2 rounded-lg text-sm font-bold">
                                            <i class="fas fa-cart-plus mr-2"></i>เพิ่มตะกร้า
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </section>
            `;
        }

        function renderBookingsPage() {
            return `
                <section class="py-20 min-h-screen">
                    <div class="container mx-auto px-4 lg:px-8">
                        <div class="text-center mb-16">
                            <h2 class="text-4xl font-bold mb-4">จองวัตถุมงคลล่วงหน้า</h2>
                            <p class="text-gray-400">จองก่อนพิธีปลุกเสกวัตถุมงคลพิเศษ</p>
                        </div>

                        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${window.appState.bookings.length === 0 ? 
                                '<p class="col-span-full text-center text-gray-400 py-12">ไม่มีการจองอยู่ในขณะนี้</p>' :
                                window.appState.bookings.map((b, i) => `
                                    <div class="glass rounded-lg p-6 animate-fade-in-up" style="animation-delay: ${i * 0.1}s">
                                        <h3 class="text-xl font-bold text-white mb-4">${b.name}</h3>
                                        <button class="w-full btn-gold py-2 rounded-lg font-bold">จองเลย</button>
                                    </div>
                                `).join('')}
                        </div>
                    </div>
                </section>
            `;
        }

        async function loadWalletData() {
            if (!window.appState.currentUser) return;
            
            const userDoc = await getDoc(doc(db, 'users', window.appState.currentUser.uid));
            const userData = userDoc.data();

            document.getElementById('main-content').innerHTML = `
                <section class="py-20 min-h-screen">
                    <div class="container mx-auto px-4 lg:px-8 max-w-2xl">
                        <h2 class="text-4xl font-bold mb-12">กระเป๋าเงิน</h2>

                        <div class="glass rounded-2xl p-8 mb-8">
                            <div class="flex justify-between items-center mb-6">
                                <div>
                                    <p class="text-gray-400 mb-2">ยอดเงินคงเหลือ</p>
                                    <h3 class="text-5xl font-bold gold-gradient">฿${(userData?.wallet || 0).toLocaleString()}</h3>
                                </div>
                                <div class="gold-bg w-24 h-24 rounded-2xl flex items-center justify-center shadow-lg">
                                    <i class="fas fa-wallet text-black text-4xl"></i>
                                </div>
                            </div>
                            <div class="flex gap-4">
                                <button class="flex-1 btn-gold py-3 rounded-lg font-bold">เติมเงิน</button>
                                <button class="flex-1 btn-outline-gold py-3 rounded-lg font-bold">ถอนเงิน</button>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        }

        // Cart Functions
        window.addToCart = (productId) => {
            if (!window.appState.currentUser) {
                showAuthModal('login');
                return;
            }

            const product = window.appState.products.find(p => p.id === productId);
            if (!product) return;

            const existing = window.appState.cart.find(item => item.id === productId);
            if (existing) {
                existing.quantity++;
            } else {
                window.appState.cart.push({ id: productId, quantity: 1 });
            }

            localStorage.setItem('cart', JSON.stringify(window.appState.cart));
            renderCart();
            showToast(`เพิ่ม ${product.name} ลงตะกร้า`);
        };

        window.renderCart = () => {
            const cartItems = document.getElementById('cart-items');
            const cartCount = document.getElementById('cart-count');
            const cartTotal = document.getElementById('cart-total');

            let totalItems = 0;
            let totalPrice = 0;

            window.appState.cart.forEach(item => {
                const product = window.appState.products.find(p => p.id === item.id);
                if (product) {
                    totalItems += item.quantity;
                    totalPrice += (product.price || 0) * item.quantity;
                }
            });

            cartCount.textContent = totalItems;
            cartCount.classList.toggle('hidden', totalItems === 0);
            cartTotal.textContent = '฿' + totalPrice.toLocaleString();

            if (window.appState.cart.length === 0) {
                cartItems.innerHTML = '<p class="text-gray-400 text-center py-8">ตะกร้าว่างเปล่า</p>';
                return;
            }

            cartItems.innerHTML = window.appState.cart.map(item => {
                const product = window.appState.products.find(p => p.id === item.id);
                if (!product) return '';
                return `
                    <div class="glass p-4 rounded-lg flex items-center gap-4">
                        <img src="${product.image || 'https://via.placeholder.com/50x50'}" class="w-16 h-16 rounded-lg object-cover">
                        <div class="flex-1">
                            <h4 class="font-bold text-sm text-white">${product.name}</h4>
                            <p class="text-amber-400 font-bold">฿${(product.price || 0).toLocaleString()}</p>
                        </div>
                        <button onclick="removeFromCart('${item.id}')" class="text-red-400 hover:text-red-600">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
            }).join('');
        };

        window.removeFromCart = (productId) => {
            window.appState.cart = window.appState.cart.filter(i => i.id !== productId);
            localStorage.setItem('cart', JSON.stringify(window.appState.cart));
            renderCart();
        };

        window.toggleCart = () => {
            document.getElementById('cart-sidebar').classList.toggle('translate-x-full');
        };

        window.checkout = async () => {
            if (!window.appState.currentUser) {
                showAuthModal('login');
                return;
            }

            if (window.appState.cart.length === 0) {
                showToast('ตะกร้าว่างเปล่า', 'error');
                return;
            }

            try {
                let totalPrice = 0;
                const orderItems = [];

                window.appState.cart.forEach(item => {
                    const product = window.appState.products.find(p => p.id === item.id);
                    if (product) {
                        totalPrice += (product.price || 0) * item.quantity;
                        orderItems.push({
                            productId: item.id,
                            name: product.name,
                            price: product.price,
                            quantity: item.quantity
                        });
                    }
                });

                await addDoc(collection(db, 'orders'), {
                    userId: window.appState.currentUser.uid,
                    items: orderItems,
                    total: totalPrice,
                    status: 'pending',
                    createdAt: serverTimestamp()
                });

                window.appState.cart = [];
                localStorage.removeItem('cart');
                toggleCart();
                renderCart();
                showToast('สั่งซื้อสำเร็จ!');
            } catch (error) {
                showToast('เกิดข้อผิดพลาด', 'error');
            }
        };

        // UI Functions
        window.showAuthModal = (type) => {
            document.getElementById('auth-modal').classList.remove('hidden');
            switchAuthForm(type);
        };

        window.switchAuthForm = (type) => {
            document.getElementById('login-form').classList.toggle('hidden', type !== 'login');
            document.getElementById('register-form').classList.toggle('hidden', type !== 'register');
        };

        window.closeModal = (id) => {
            document.getElementById(id).classList.add('hidden');
        };

        window.showToast = (message, type = 'success') => {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toast-icon');
            const text = document.getElementById('toast-text');

            icon.className = type === 'error' ? 'fas fa-exclamation-circle text-red-400' : 'fas fa-check-circle text-green-400';
            text.textContent = message;

            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => toast.classList.add('translate-y-20', 'opacity-0'), 3000);
        };

        function updateUI() {
            const authButtons = document.getElementById('auth-buttons');
            const userMenu = document.getElementById('user-menu');
            const userDisplay = document.getElementById('user-display');

            if (window.appState.currentUser) {
                authButtons.classList.add('hidden');
                userMenu.classList.remove('hidden');
                userDisplay.textContent = window.appState.currentUser.name || window.appState.currentUser.email;
            } else {
                authButtons.classList.remove('hidden');
                userMenu.classList.add('hidden');
            }
        }

        // Initialize
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                window.appState.currentUser = {
                    uid: user.uid,
                    email: user.email,
                    ...userDoc.data()
                };
            }
            updateUI();
            renderCart();
        });

        await loadProducts();
        await showPage('home');
        document.getElementById('loading-overlay').classList.add('hidden');

        window.db = db;
        window.auth = auth;
    </script>
</body>
</html>
